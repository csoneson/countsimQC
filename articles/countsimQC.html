<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>countsimQC - Comparing characteristic features across count data sets • countsimQC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="countsimQC - Comparing characteristic features across count data sets">
<meta property="og:description" content="countsimQC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">countsimQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/countsimQC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/csoneson/countsimQC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="countsimQC_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>countsimQC - Comparing characteristic features across count data sets</h1>
                        <h4 class="author">Charlotte Soneson</h4>
            
            <h4 class="date">2020-07-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/csoneson/countsimQC/blob/master/vignettes/countsimQC.Rmd"><code>vignettes/countsimQC.Rmd</code></a></small>
      <div class="hidden name"><code>countsimQC.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <code>countsimQC</code> package provides a simple way to compare the characteristic features of a collection of (e.g., RNA-seq) count data sets. An important application is in situations where a synthetic count data set has been generated using a real count data set as an underlying source of parameters, in which case it is often important to verify that the final synthetic data captures the main features of the original data set. However, the package can be used to create a visual overview of any collection of one or more count data sets.</p>
</div>
<div id="data-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h2>
<p>In this vignette we will show how to generate a comparative report from a collection of two simulated data sets and the original, underlying real data set. First, we load the object containing the three data sets. The object is a named list, where each element is a <code>DESeqDataSet</code> object, containing the count matrix, a sample information data frame and a model formula (necessary to calculate dispersions). For more information about the <code>DESeqDataSet</code> class, please see the <a href="http://bioconductor.org/packages/release/bioc/html/DESeq2.html"><code>DESeq2</code></a> Bioconductor package. For speed reasons, we use only a subset of the features in each data set for the following calculations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>({
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/csoneson/countsimQC">countsimQC</a></span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/mikelove/DESeq2">DESeq2</a></span>)
})

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">countsimExample</span>)
<span class="kw">countsimExample</span>
</pre></div>
<pre><code>## $Original
## class: DESeqDataSet 
## dim: 10000 11 
## metadata(1): version
## assays(1): counts
## rownames(10000): ENSMUSG00000000001.4 ENSMUSG00000000028.14 ...
##   ENSMUSG00000048027.7 ENSMUSG00000048029.10
## rowData names(0):
## colnames(11): GSM1923445 GSM1923446 ... GSM1923578 GSM1923579
## colData names(2): group sample
## 
## $Sim1
## class: DESeqDataSet 
## dim: 10000 11 
## metadata(1): version
## assays(1): counts
## rownames(10000): Gene1 Gene2 ... Gene9999 Gene10000
## rowData names(0):
## colnames(11): Cell1 Cell2 ... Cell88 Cell89
## colData names(4): Cell Batch Group ExpLibSize
## 
## $Sim2
## class: DESeqDataSet 
## dim: 10000 11 
## metadata(1): version
## assays(1): counts
## rownames(10000): Gene1 Gene2 ... Gene9999 Gene10000
## rowData names(0):
## colnames(11): Cell1 Cell2 ... Cell88 Cell89
## colData names(3): Cell CellFac Group</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">countsimExample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">countsimExample</span>, <span class="fu">function</span>(<span class="kw">cse</span>) {
  <span class="kw">cse</span>[<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">1500</span>), ]
})
</pre></div>
</div>
<div id="report-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#report-generation" class="anchor"></a>Report generation</h2>
<p>Next, we generate the report using the <code><a href="../reference/countsimQCReport.html">countsimQCReport()</a></code> function. Depending on the level of detail and the type of information that are required for the final report, this function can be run in different “modes”:</p>
<ul>
<li>by setting <code>calculateStatistics = FALSE</code>, only plots will be generated. This is the fastest way of running <code><a href="../reference/countsimQCReport.html">countsimQCReport()</a></code>, and in many cases generates enough information for the user to make a visual evaluation of the count data set(s).</li>
<li>by setting <code>calculateStatistics = TRUE</code> and <code>permutationPvalues = FALSE</code>, some quantitative pairwise comparisons between data sets will be performed. In particular, the Kolmogorov-Smirnov test and the Wald-Wolfowitz runs test will be used to compare distributions, and additional statistics will be calculated to evaluate how similar the evaluated aspects are between pairs of data sets.</li>
<li>by setting <code>calculateStatistics = TRUE</code> and <code>permutationPvalues = TRUE</code> (and giving the requested number of permutations via the <code>nPermutations</code> argument), permutation of data set labels will be used to evaluate the significance of the statistics calculated in the previous point. Naturally, this increases the run time of the analysis considerably.</li>
</ul>
<p>Here, for the sake of speed, we calculate statistics for a small subset of the observations (<code>subsampleSize = 25</code>) and refrain from calculating permutation p-values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">tempDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
<span class="fu"><a href="../reference/countsimQCReport.html">countsimQCReport</a></span>(ddsList = <span class="kw">countsimExample</span>, outputFile = <span class="st">"countsim_report.html"</span>,
                 outputDir = <span class="kw">tempDir</span>, outputFormat = <span class="st">"html_document"</span>, 
                 showCode = <span class="fl">FALSE</span>, forceOverwrite = <span class="fl">TRUE</span>,
                 savePlots = <span class="fl">TRUE</span>, description = <span class="st">"This is my test report."</span>, 
                 maxNForCorr = <span class="fl">25</span>, maxNForDisp = <span class="fl">Inf</span>, 
                 calculateStatistics = <span class="fl">TRUE</span>, subsampleSize = <span class="fl">25</span>,
                 kfrac = <span class="fl">0.01</span>, kmin = <span class="fl">5</span>, 
                 permutationPvalues = <span class="fl">FALSE</span>, nPermutations = <span class="kw">NULL</span>)
</pre></div>
<p>The <code><a href="../reference/countsimQCReport.html">countsimQCReport()</a></code> function can generate either an HTML file (by setting <code>outputFormat = "html_document"</code> or <code>outputFormat = NULL</code>) or a pdf file (by setting <code>outputFormat = "pdf_document"</code>). The <code>description</code> argument can be used to provide a more extensive description of the data set(s) that are included in the report.</p>
</div>
<div id="generation-of-individual-figures" class="section level2">
<h2 class="hasAnchor">
<a href="#generation-of-individual-figures" class="anchor"></a>Generation of individual figures</h2>
<p>If the argument <code>savePlots</code> is set to TRUE, an .rds file containing the individual ggplot objects will be generated. These objects can be used to perform fine-tuning of the visualizations if desired. Note, however, that the .rds file can become large if the number of data sets is large, or if the individual data sets have many samples or features. The convenience function <code><a href="../reference/generateIndividualPlots.html">generateIndividualPlots()</a></code> can be used to quickly generate individual figures for all plots included in the report, using a variety of devices. For example, to generate each plot in pdf format:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">ggplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tempDir</span>, <span class="st">"countsim_report_ggplots.rds"</span>))
<span class="co">if</span> (<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tempDir</span>, <span class="st">"figures"</span>))) {
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tempDir</span>, <span class="st">"figures"</span>))
}
<span class="fu"><a href="../reference/generateIndividualPlots.html">generateIndividualPlots</a></span>(<span class="kw">ggplots</span>, device = <span class="st">"pdf"</span>, nDatasets = <span class="fl">3</span>, 
                        outputDir = <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tempDir</span>, <span class="st">"figures"</span>))
</pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div id="input-data-format" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data-format" class="anchor"></a>Input data format</h2>
<p>In the example above, all data sets were provided as <code>DESeqDataSet</code> objects. The advantage of this is that it allows the specification of the experimental design, which is used in the dispersion calculations. <code>countsimQC</code> also allows a data set to be provided as either a <code>data.frame</code> or a <code>matrix</code>. However, in these situations, it will be assumed that all samples are replicates (i.e., a design <code>~1</code>). An example is provided in the <code>countsimExample_dfmat</code> data set, provided with the package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">countsimExample_dfmat</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">countsimExample_dfmat</span>)
</pre></div>
<pre><code>## [1] "Original" "Sim1"     "Sim2"</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">countsimExample_dfmat</span>, <span class="kw">class</span>)
</pre></div>
<pre><code>## $Original
## [1] "DESeqDataSet"
## attr(,"package")
## [1] "DESeq2"
## 
## $Sim1
## [1] "matrix" "array" 
## 
## $Sim2
## [1] "data.frame"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">tempDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
<span class="fu"><a href="../reference/countsimQCReport.html">countsimQCReport</a></span>(ddsList = <span class="kw">countsimExample_dfmat</span>, 
                 outputFile = <span class="st">"countsim_report_dfmat.html"</span>,
                 outputDir = <span class="kw">tempDir</span>, outputFormat = <span class="st">"html_document"</span>, 
                 showCode = <span class="fl">FALSE</span>, forceOverwrite = <span class="fl">TRUE</span>,
                 savePlots = <span class="fl">TRUE</span>, description = <span class="st">"This is my test report."</span>, 
                 maxNForCorr = <span class="fl">25</span>, maxNForDisp = <span class="fl">Inf</span>, 
                 calculateStatistics = <span class="fl">TRUE</span>, subsampleSize = <span class="fl">25</span>,
                 kfrac = <span class="fl">0.01</span>, kmin = <span class="fl">5</span>, 
                 permutationPvalues = <span class="fl">FALSE</span>, nPermutations = <span class="kw">NULL</span>)
</pre></div>
</div>
<div id="session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h2>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()
</pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] DESeq2_1.29.6               SummarizedExperiment_1.19.5
##  [3] DelayedArray_0.15.6         matrixStats_0.56.0         
##  [5] Matrix_1.2-18               Biobase_2.49.0             
##  [7] GenomicRanges_1.41.5        GenomeInfoDb_1.25.5        
##  [9] IRanges_2.23.10             S4Vectors_0.27.12          
## [11] BiocGenerics_0.35.4         countsimQC_1.7.1           
## 
## loaded via a namespace (and not attached):
##  [1] edgeR_3.31.4           tidyr_1.1.0            jsonlite_1.7.0        
##  [4] bit64_0.9-7            splines_4.0.2          assertthat_0.2.1      
##  [7] blob_1.2.1             GenomeInfoDbData_1.2.3 yaml_2.2.1            
## [10] pillar_1.4.4           RSQLite_2.2.0          backports_1.1.8       
## [13] lattice_0.20-41        glue_1.4.1             limma_3.45.7          
## [16] digest_0.6.25          RColorBrewer_1.1-2     XVector_0.29.3        
## [19] colorspace_1.4-1       htmltools_0.5.0        XML_3.99-0.3          
## [22] pkgconfig_2.0.3        genefilter_1.71.0      zlibbioc_1.35.0       
## [25] purrr_0.3.4            xtable_1.8-4           scales_1.1.1          
## [28] BiocParallel_1.23.0    tibble_3.0.1           annotate_1.67.0       
## [31] mgcv_1.8-31            farver_2.0.3           generics_0.0.2        
## [34] ggplot2_3.3.2          ellipsis_0.3.1         DT_0.14               
## [37] withr_2.2.0            survival_3.1-12        magrittr_1.5          
## [40] crayon_1.3.4           memoise_1.1.0          evaluate_0.14         
## [43] fs_1.4.2               nlme_3.1-148           tools_4.0.2           
## [46] lifecycle_0.2.0        stringr_1.4.0          munsell_0.5.0         
## [49] locfit_1.5-9.4         AnnotationDbi_1.51.1   compiler_4.0.2        
## [52] pkgdown_1.5.1.9000     caTools_1.18.0         rlang_0.4.6           
## [55] randtests_1.0          grid_4.0.2             RCurl_1.98-1.2        
## [58] htmlwidgets_1.5.1      crosstalk_1.1.0.1      labeling_0.3          
## [61] bitops_1.0-6           rmarkdown_2.3.2        gtable_0.3.0          
## [64] DBI_1.1.0              R6_2.4.1               knitr_1.29            
## [67] dplyr_1.0.0            bit_1.1-15.2           rprojroot_1.3-2       
## [70] desc_1.2.0             stringi_1.4.6          Rcpp_1.0.4.6          
## [73] vctrs_0.3.1            geneplotter_1.67.0     tidyselect_1.1.0      
## [76] xfun_0.15</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Charlotte Soneson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
